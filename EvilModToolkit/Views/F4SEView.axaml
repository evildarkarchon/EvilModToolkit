<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:EvilModToolkit.ViewModels"
             xmlns:models="using:EvilModToolkit.Models"
             xmlns:converters="using:EvilModToolkit.Converters"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="EvilModToolkit.Views.F4SEView"
             x:DataType="vm:F4SEViewModel"
             x:Name="Root">

    <Design.DataContext>
        <vm:F4SEViewModel />
    </Design.DataContext>

    <UserControl.Resources>
        <converters:F4SeCompatibilityToStringConverter x:Key="F4SeCompatibilityToStringConverter" />
        <converters:F4SeCompatibilityToColorConverter x:Key="F4SeCompatibilityToColorConverter" />
    </UserControl.Resources>

    <DockPanel Margin="20">
        <!-- Header Section -->
        <Grid DockPanel.Dock="Top" ColumnDefinitions="*,Auto" Margin="0,0,0,15">
            <StackPanel Grid.Column="0" Spacing="5">
                <TextBlock Text="F4SE Plugin Scanner"
                           FontSize="24"
                           FontWeight="Bold" />
                <TextBlock Text="{Binding PluginDirectory}"
                           Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
            </StackPanel>
            <Button Grid.Column="1"
                    Content="Scan Plugins"
                    Command="{Binding ScanPluginsCommand}"
                    Padding="20,8"
                    VerticalAlignment="Top" />
        </Grid>

        <!-- Filter Section -->
        <Border DockPanel.Dock="Top"
                BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                BorderThickness="1"
                Padding="15"
                Margin="0,0,0,15"
                CornerRadius="5">
            <StackPanel Spacing="10">
                <TextBlock Text="Filters"
                           FontSize="16"
                           FontWeight="SemiBold" />
                <WrapPanel>
                    <CheckBox Content="OG Only"
                              IsChecked="{Binding ShowOgOnly}"
                              Margin="0,0,15,0" />
                    <CheckBox Content="NG Only"
                              IsChecked="{Binding ShowNgOnly}"
                              Margin="0,0,15,0" />
                    <CheckBox Content="Universal"
                              IsChecked="{Binding ShowUniversal}"
                              Margin="0,0,15,0" />
                    <CheckBox Content="Incompatible/Unknown"
                              IsChecked="{Binding ShowIncompatible}" />
                </WrapPanel>
            </StackPanel>
        </Border>

        <!-- Statistics Section -->
        <Border DockPanel.Dock="Top"
                BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                BorderThickness="1"
                Padding="15"
                Margin="0,0,0,15"
                CornerRadius="5">
            <Grid ColumnDefinitions="*,*,*,*,*">
                <StackPanel Grid.Column="0" Spacing="5">
                    <TextBlock Text="Total"
                               FontSize="12"
                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
                    <TextBlock Text="{Binding TotalPluginCount}"
                               FontSize="24"
                               FontWeight="Bold" />
                </StackPanel>
                <StackPanel Grid.Column="1" Spacing="5">
                    <TextBlock Text="OG Only"
                               FontSize="12"
                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
                    <TextBlock Text="{Binding OgOnlyCount}"
                               FontSize="24"
                               FontWeight="Bold" />
                </StackPanel>
                <StackPanel Grid.Column="2" Spacing="5">
                    <TextBlock Text="NG Only"
                               FontSize="12"
                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
                    <TextBlock Text="{Binding NgOnlyCount}"
                               FontSize="24"
                               FontWeight="Bold" />
                </StackPanel>
                <StackPanel Grid.Column="3" Spacing="5">
                    <TextBlock Text="Universal"
                               FontSize="12"
                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
                    <TextBlock Text="{Binding UniversalCount}"
                               FontSize="24"
                               FontWeight="Bold"
                               Foreground="Green" />
                </StackPanel>
                <StackPanel Grid.Column="4" Spacing="5">
                    <TextBlock Text="Incompatible"
                               FontSize="12"
                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
                    <TextBlock Text="{Binding IncompatibleCount}"
                               FontSize="24"
                               FontWeight="Bold"
                               Foreground="Orange" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- Progress and Status -->
        <StackPanel DockPanel.Dock="Bottom" Margin="0,15,0,0" Spacing="10">
            <ProgressBar Value="{Binding ProgressPercentage}"
                         IsVisible="{Binding IsBusy}"
                         Height="6" />
            <TextBlock Text="{Binding StatusMessage}"
                       IsVisible="{Binding StatusMessage, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Inverse}"
                       Foreground="{DynamicResource SystemAccentColor}" />
            <TextBlock Text="{Binding ErrorMessage}"
                       IsVisible="{Binding ErrorMessage, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Inverse}"
                       Foreground="Red"
                       TextWrapping="Wrap" />
        </StackPanel>

        <!-- Plugin List - fills remaining space -->
        <ScrollViewer VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled"
                      Margin="0,0,0,15">
            <StackPanel>
                <!-- Column Headers -->
                <Border BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                        BorderThickness="0,0,0,1"
                        Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                        Padding="10,8">
                    <Grid ColumnDefinitions="3*,1*,2*">
                        <TextBlock Grid.Column="0" Text="Plugin Name" FontWeight="Bold" />
                        <TextBlock Grid.Column="1" Text="Version" FontWeight="Bold" />
                        <TextBlock Grid.Column="2" Text="Compatibility" FontWeight="Bold" />
                    </Grid>
                </Border>

                <!-- Plugin List -->
                <ItemsControl ItemsSource="{Binding Plugins}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                                    BorderThickness="0,0,0,1"
                                    Padding="10,8">
                                <Grid ColumnDefinitions="3*,1*,2*">
                                    <TextBlock Grid.Column="0" Text="{Binding FileName}"
                                               TextTrimming="CharacterEllipsis" />
                                    <TextBlock Grid.Column="1" Text="{Binding Version}" />
                                    <TextBlock Grid.Column="2" 
                                               Text="{Binding Compatibility, Converter={StaticResource F4SeCompatibilityToStringConverter}}">
                                        <TextBlock.Foreground>
                                            <MultiBinding Converter="{StaticResource F4SeCompatibilityToColorConverter}">
                                                <Binding Path="Compatibility" />
                                                <Binding ElementName="Root" Path="DataContext.IsNextGen" />
                                            </MultiBinding>
                                        </TextBlock.Foreground>
                                    </TextBlock>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>
        </ScrollViewer>
    </DockPanel>

</UserControl>