<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:EvilModToolkit.ViewModels"
             xmlns:models="using:EvilModToolkit.Models"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="EvilModToolkit.Views.ScannerView"
             x:DataType="vm:ScannerViewModel">

  <UserControl.Styles>
    <Style Selector="TextBlock.h1">
      <Setter Property="FontSize" Value="24"/>
      <Setter Property="FontWeight" Value="Bold"/>
      <Setter Property="Margin" Value="0,0,0,10"/>
    </Style>
    <Style Selector="TextBlock.label">
      <Setter Property="FontWeight" Value="Bold"/>
      <Setter Property="Margin" Value="0,5,5,0"/>
    </Style>
  </UserControl.Styles>

  <Grid ColumnDefinitions="250, *">
    
    <!-- Left Panel: Settings and Controls -->
    <Border Grid.Column="0" Background="{DynamicResource SystemRegionBrush}" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="0,0,1,0" Padding="10">
      <StackPanel Spacing="10">
        <TextBlock Text="Scan Settings" Classes="h1" FontSize="18"/>
        
        <CheckBox IsChecked="{Binding ScanOptions.ScanJunkFiles}" Content="Junk Files"/>
        <CheckBox IsChecked="{Binding ScanOptions.ScanLoosePrevis}" Content="Loose Previs"/>
        <CheckBox IsChecked="{Binding ScanOptions.ScanProblemOverrides}" Content="Problem Overrides"/>
        <CheckBox IsChecked="{Binding ScanOptions.ScanWrongFormat}" Content="Wrong Format"/>
        <CheckBox IsChecked="{Binding ScanOptions.ScanErrors}" Content="Known Errors"/>
        <CheckBox IsChecked="{Binding ScanOptions.ScanRaceSubgraphs}" Content="Race Subgraphs"/>
        <CheckBox IsChecked="{Binding ScanOptions.SkipDataScan}" Content="Skip Data Scan"/>

        <Separator Margin="0,10"/>

        <Button Content="Scan Game" 
                Command="{Binding ScanCommand}" 
                HorizontalAlignment="Stretch" 
                Classes="accent"/>
                
        <Button Content="Cancel" 
                Command="{Binding CancelScanCommand}" 
                HorizontalAlignment="Stretch"
                IsVisible="{Binding IsBusy}"/>

        <ProgressBar IsIndeterminate="True" IsVisible="{Binding IsBusy}" Height="2"/>
        
        <TextBlock Text="{Binding ResultsInfo}" 
                   TextWrapping="Wrap" 
                   HorizontalAlignment="Center" 
                   Margin="0,10"/>
      </StackPanel>
    </Border>

    <!-- Right Panel: Results and Details -->
    <Grid Grid.Column="1" RowDefinitions="*, Auto">
      
      <!-- Results DataGrid -->
      <DataGrid Grid.Row="0" 
                ItemsSource="{Binding Results}" 
                SelectedItem="{Binding SelectedResult}"
                AutoGenerateColumns="False" 
                IsReadOnly="True"
                GridLinesVisibility="All"
                BorderThickness="0"
                Margin="0">
        <DataGrid.Columns>
           <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="Auto"/>
           <DataGridTextColumn Header="Severity" Binding="{Binding Severity}" Width="Auto"/>
           <DataGridTextColumn Header="Problem" Binding="{Binding RelativePath}" Width="*"/>
           <DataGridTextColumn Header="Mod" Binding="{Binding ModName}" Width="Auto"/>
        </DataGrid.Columns>
      </DataGrid>

      <!-- Details Panel -->
      <Border Grid.Row="1" 
              BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" 
              BorderThickness="0,1,0,0" 
              Padding="15" 
              Background="{DynamicResource SystemRegionBrush}"
              IsVisible="{Binding SelectedResult, Converter={StaticResource NullToVisibilityConverter}}">
        <Grid RowDefinitions="Auto, Auto, Auto, Auto, Auto" ColumnDefinitions="Auto, *">
          
          <TextBlock Grid.Row="0" Grid.Column="0" Text="Problem:" Classes="label"/>
          <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding SelectedResult.Summary}" TextWrapping="Wrap" Margin="0,5,0,5"/>

          <TextBlock Grid.Row="1" Grid.Column="0" Text="File:" Classes="label"/>
          <SelectableTextBlock Grid.Row="1" Grid.Column="1" Text="{Binding SelectedResult.Path}" TextWrapping="Wrap" Margin="0,5,0,5"/>
          
          <TextBlock Grid.Row="2" Grid.Column="0" Text="Solution:" Classes="label"/>
          <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding SelectedResult.GetSolutionText}" TextWrapping="Wrap" FontWeight="SemiBold" Margin="0,5,0,5"/>
          
        </Grid>
      </Border>

    </Grid>
  </Grid>
</UserControl>
